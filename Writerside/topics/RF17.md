# üëë RF17 - Promover Usu√°rio a Administrador

![Logo.png](Logo.png){ width=150 }

## üìù Descri√ß√£o

Este requisito funcional permite que um administrador conceda a outro operador do sistema privil√©gios de administra√ß√£o, elevando seu n√≠vel de acesso. A promo√ß√£o de um usu√°rio a administrador √© uma opera√ß√£o cr√≠tica que amplia significativamente as permiss√µes do operador no sistema Quilombo Pena Branca, permitindo que ele gerencie outros usu√°rios e acesse funcionalidades restritas.

## üëë Atores

- Administrador (somente administradores podem promover outros usu√°rios)

## ‚úÖ Pr√©-condi√ß√µes

- O administrador deve estar autenticado no sistema
- O operador a ser promovido deve estar cadastrado e ativo no sistema
- Deve haver ao menos outro administrador ativo no sistema al√©m do que est√° realizando a opera√ß√£o

## üåê Endpoint

- `PATCH /api/v1/users/{id}/promote`

## üìä Dados para Promo√ß√£o

| Campo         | Tipo   | Obrigat√≥rio | Restri√ß√µes                             |
|---------------|--------|-------------|----------------------------------------|
| userId        | Long   | ‚úì           | ID do operador a ser promovido         |
| justification | String | ‚úì           | Motivo da promo√ß√£o, m√≠n. 10 caracteres |

## üîÑ Fluxo Principal

```mermaid
sequenceDiagram
    participant A as Administrador
    participant S as Sistema
    participant DB as Banco de Dados
    
    A->>S: Acessa a lista de operadores
    S->>DB: Busca operadores cadastrados
    DB->>S: Retorna lista de operadores
    S->>A: Exibe lista de operadores
    A->>S: Seleciona um operador
    S->>A: Exibe detalhes do operador
    A->>S: Clica no bot√£o "Promover a Administrador"
    S->>A: Exibe modal de confirma√ß√£o com campo para justificativa
    A->>S: Preenche justificativa e confirma
    S->>S: Valida dados
    S->>DB: Atualiza n√≠vel de acesso do operador
    DB->>S: Confirma atualiza√ß√£o
    S->>DB: Registra a√ß√£o no log de auditoria
    S->>A: Exibe mensagem de confirma√ß√£o
    S->>A: Atualiza interface mostrando novo status
```

## üîÄ Fluxos Alternativos

### 1. Operador j√° √© administrador

```mermaid
sequenceDiagram
    participant A as Administrador
    participant S as Sistema
    participant DB as Banco de Dados
    
    A->>S: Seleciona um operador para promover
    S->>DB: Verifica status atual do operador
    DB->>S: Retorna que j√° √© administrador
    S->>A: Exibe mensagem "Operador j√° possui privil√©gios de administrador"
    S->>A: Mant√©m na tela de detalhes do operador
```

### 2. Operador inativo

```mermaid
sequenceDiagram
    participant A as Administrador
    participant S as Sistema
    participant DB as Banco de Dados
    
    A->>S: Seleciona um operador inativo para promover
    S->>DB: Verifica status do operador
    DB->>S: Retorna status inativo
    S->>A: Exibe mensagem "N√£o √© poss√≠vel promover um operador inativo"
    S->>A: Sugere ativar o operador primeiro
```

### 3. Justificativa insuficiente

```mermaid
sequenceDiagram
    participant A as Administrador
    participant S as Sistema
    
    A->>S: Tenta promover com justificativa muito curta
    S->>S: Valida justificativa
    S->>A: Exibe mensagem "Justificativa deve conter pelo menos 10 caracteres"
    S->>A: Mant√©m modal aberto para corre√ß√£o
```

## üìÑ Exemplo de Requisi√ß√£o e Resposta

**Requisi√ß√£o:**
```http
PATCH /api/v1/users/42/promote HTTP/1.1
Host: api.quilombopenabranca.org
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

{
  "justification": "Operador com experi√™ncia comprovada e necessidade de gerir equipe regional do Quilombo."
}
```

**Resposta:**
```json
{
  "userId": 42,
  "userName": "Maria da Silva",
  "isAdmin": true,
  "promotedAt": "2023-05-22T10:15:30Z",
  "promotedBy": "Jo√£o Administrador",
  "message": "Promo√ß√£o realizada com sucesso"
}
```

## üñºÔ∏è Interface de Refer√™ncia

![promote.png](promote.png)

## üîê Considera√ß√µes de Seguran√ßa

- **Auditoria Completa**: Toda promo√ß√£o √© registrada com informa√ß√µes detalhadas (quem promoveu, quando, justificativa)
- **Notifica√ß√£o**: O sistema envia notifica√ß√£o por e-mail tanto para o administrador que realizou a a√ß√£o quanto para o operador promovido
- **Confirma√ß√£o em Duas Etapas**: Para contas particularmente sens√≠veis, o sistema pode exigir confirma√ß√£o por segundo administrador
- **Per√≠odo de Observa√ß√£o**: Novos administradores podem ter algumas a√ß√µes monitoradas durante per√≠odo inicial (15 dias)

## ‚ö†Ô∏è Impactos da Promo√ß√£o

Ao ser promovido a administrador, o operador ganha acesso a:

- Gerenciamento completo de usu√°rios (cadastro, edi√ß√£o, exclus√£o, redefini√ß√£o de senhas)
- Visualiza√ß√£o de logs e registros de auditoria
- Configura√ß√µes gerais do sistema
- Promo√ß√£o de outros operadores a administrador
- Acesso a relat√≥rios administrativos e estat√≠sticas sens√≠veis

## üìä Monitoramento

O sistema monitora automaticamente a√ß√µes de:

- N√∫mero de promo√ß√µes realizadas por per√≠odo
- Comportamento de novos administradores
- Tentativas de promo√ß√£o n√£o conclu√≠das
- Justificativas utilizadas na promo√ß√£o

---

#### üåô Quilombo Pena Branca üåô
Honrando nossas ra√≠zes, construindo nosso futuro