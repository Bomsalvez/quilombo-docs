# ‚úèÔ∏èüóëÔ∏è RF14 - Editar e Excluir Obriga√ß√µes

![Logo.png](Logo.png){ width=150 }

## üìù Descri√ß√£o

Este requisito funcional permite que os operadores modifiquem informa√ß√µes de obriga√ß√µes religiosas j√° registradas ou excluam registros quando necess√°rio. A funcionalidade possibilita a corre√ß√£o de dados incorretos ou desatualizados, bem como a remo√ß√£o de registros indevidos, mantendo a integridade e precis√£o do hist√≥rico espiritual dos membros do Quilombo Pena Branca.

## üëë Atores

- Administrador do sistema
- Operador

## ‚úÖ Pr√©-condi√ß√µes

- O operador deve estar autenticado no sistema
- O operador deve possuir permiss√£o para editar/excluir obriga√ß√µes
- A obriga√ß√£o a ser editada/exclu√≠da deve existir no sistema

## üåê Endpoints

- `PUT /api/v1/obligations/{id}` (editar obriga√ß√£o)
- `DELETE /api/v1/obligations/{id}` (excluir obriga√ß√£o)

## üìä Dados para Edi√ß√£o de Obriga√ß√£o

| Campo        | Tipo       | Obrigat√≥rio | Restri√ß√µes                                |
|--------------|------------|-------------|-------------------------------------------|
| memberId     | Long       | ‚úì           | ID de membro existente no sistema         |
| type         | String     | ‚úì           | Tipo da obriga√ß√£o (enum de tipos v√°lidos) |
| date         | LocalDate  | ‚úì           | Data n√£o pode ser futura                  |
| description  | String     | ‚úì           | M√≠nimo 10, m√°ximo 500 caracteres          |
| observations | String     | ‚ùå           | M√°ximo 1000 caracteres                    |
| officiant    | String     | ‚úì           | Nome do oficiante/respons√°vel             |
| location     | String     | ‚úì           | Local onde foi realizada                  |
| attachments  | List<File> | ‚ùå           | Arquivos relacionados (fotos, documentos) |

## üìä Dados para Exclus√£o de Obriga√ß√£o

| Campo         | Tipo     | Obrigat√≥rio | Restri√ß√µes                         |
|---------------|----------|-------------|-----------------------------------|
| id            | Long     | ‚úì           | ID da obriga√ß√£o a ser exclu√≠da    |
| reason        | String   | ‚úì           | Motivo da exclus√£o, m√≠n. 5 caracteres |

## üîÑ Fluxo Principal - Editar Obriga√ß√£o

```mermaid
sequenceDiagram
    participant O as Operador
    participant S as Sistema
    participant DB as Banco de Dados
    
    O->>S: Acessa a p√°gina de detalhes da obriga√ß√£o
    S->>DB: Busca dados da obriga√ß√£o
    DB->>S: Retorna dados da obriga√ß√£o
    S->>O: Exibe formul√°rio com dados atuais
    O->>S: Edita informa√ß√µes
    O->>S: Adiciona/remove anexos (opcional)
    O->>S: Clica no bot√£o "Salvar"
    S->>S: Valida os dados modificados
    S->>DB: Atualiza registro da obriga√ß√£o
    DB->>S: Confirma atualiza√ß√£o
    S->>O: Exibe mensagem de confirma√ß√£o
    S->>O: Exibe tela de detalhes atualizada
```

## üîÑ Fluxo Principal - Excluir Obriga√ß√£o

```mermaid
sequenceDiagram
    participant O as Operador
    participant S as Sistema
    participant DB as Banco de Dados
    
    O->>S: Acessa a p√°gina de detalhes da obriga√ß√£o
    S->>DB: Busca dados da obriga√ß√£o
    DB->>S: Retorna dados da obriga√ß√£o
    S->>O: Exibe detalhes da obriga√ß√£o
    O->>S: Clica no bot√£o "Excluir"
    S->>O: Exibe modal de confirma√ß√£o com campo para motivo
    O->>S: Informa motivo e confirma exclus√£o
    S->>DB: Marca obriga√ß√£o como exclu√≠da (soft delete)
    S->>DB: Registra log com motivo da exclus√£o
    DB->>S: Confirma exclus√£o
    S->>O: Exibe mensagem de confirma√ß√£o
    S->>O: Redireciona para lista de obriga√ß√µes
```

## üîÄ Fluxos Alternativos

### 1. Dados inv√°lidos na edi√ß√£o

```mermaid
sequenceDiagram
    participant O as Operador
    participant S as Sistema
    
    O->>S: Edita informa√ß√µes com dados inv√°lidos
    O->>S: Clica no bot√£o "Salvar"
    S->>S: Valida os dados modificados
    S->>O: Exibe mensagens de erro nos campos inv√°lidos
    S->>O: Mant√©m os dados v√°lidos preenchidos
```

### 2. Tentativa de editar obriga√ß√£o inexistente

```mermaid
sequenceDiagram
    participant O as Operador
    participant S as Sistema
    participant DB as Banco de Dados
    
    O->>S: Tenta acessar edi√ß√£o de obriga√ß√£o com ID inv√°lido
    S->>DB: Busca obriga√ß√£o por ID
    DB->>S: Retorna que obriga√ß√£o n√£o existe
    S->>O: Exibe mensagem de erro
    S->>O: Redireciona para a lista de obriga√ß√µes
```

### 3. Cancelamento da exclus√£o

```mermaid
sequenceDiagram
    participant O as Operador
    participant S as Sistema
    
    O->>S: Clica no bot√£o "Excluir"
    S->>O: Exibe modal de confirma√ß√£o
    O->>S: Clica em "Cancelar"
    S->>O: Fecha modal de confirma√ß√£o
    S->>O: Mant√©m na tela de detalhes da obriga√ß√£o
```

## üìÑ Exemplos de Requisi√ß√£o e Resposta

### Editar obriga√ß√£o

**Requisi√ß√£o:**
```http
PUT /api/v1/obligations/123 HTTP/1.1
Host: api.quilombopenabranca.org
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

{
  "memberId": 42,
  "type": "INICIACAO",
  "date": "2023-05-16",
  "description": "Inicia√ß√£o de santo no Candombl√© Angola - Cerim√¥nia completa",
  "observations": "Cerim√¥nia ocorreu sem intercorr√™ncias, com presen√ßa de autoridades",
  "officiant": "Pai Jo√£o de Angola",
  "location": "Terreiro Quilombo Pena Branca"
}
```

**Resposta:**
```json
{
  "id": 123,
  "memberId": 42,
  "memberName": "Maria da Silva",
  "type": "INICIACAO",
  "date": "2023-05-16",
  "description": "Inicia√ß√£o de santo no Candombl√© Angola - Cerim√¥nia completa",
  "observations": "Cerim√¥nia ocorreu sem intercorr√™ncias, com presen√ßa de autoridades",
  "officiant": "Pai Jo√£o de Angola",
  "location": "Terreiro Quilombo Pena Branca",
  "createdAt": "2023-05-20T14:30:45Z",
  "createdBy": "Carlos Operador",
  "updatedAt": "2023-05-21T09:45:22Z",
  "updatedBy": "Carlos Operador",
  "attachments": []
}
```

### Excluir obriga√ß√£o

**Requisi√ß√£o:**
```http
DELETE /api/v1/obligations/123 HTTP/1.1
Host: api.quilombopenabranca.org
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

{
  "reason": "Registro duplicado. Existe outro registro id√™ntico com ID 456."
}
```

**Resposta:**
```json
{
  "message": "Obriga√ß√£o exclu√≠da com sucesso",
  "deletedAt": "2023-05-21T10:15:30Z",
  "deletedBy": "Carlos Operador"
}
```

## üñºÔ∏è Interfaces de Refer√™ncia

![Interface de Edi√ß√£o de Obriga√ß√£o](obligation-edit.png)

![Confirma√ß√£o de Exclus√£o](obligation-delete.png)

## üîê Considera√ß√µes de Seguran√ßa

- **Registro de Auditoria**: Todas as modifica√ß√µes e exclus√µes s√£o registradas com informa√ß√µes do operador, data/hora e motivo
- **Exclus√£o L√≥gica**: As exclus√µes s√£o sempre l√≥gicas (soft delete), preservando o hist√≥rico para auditoria
- **Permiss√µes Granulares**: O sistema deve permitir configurar separadamente as permiss√µes de edi√ß√£o e exclus√£o
- **Valida√ß√£o de Acesso**: Verifica√ß√£o de permiss√µes antes de exibir op√ß√µes de edi√ß√£o/exclus√£o na interface

## ‚è∞ Per√≠odo de Edi√ß√£o

Por padr√£o, as obriga√ß√µes podem ser editadas ou exclu√≠das em at√© 30 dias ap√≥s seu registro. Ap√≥s esse per√≠odo, apenas administradores podem realizar altera√ß√µes, mediante justificativa registrada no sistema.

---

  #### üåô Quilombo Pena Branca üåô
  Honrando nossas ra√≠zes, construindo nosso futuro