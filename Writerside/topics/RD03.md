# 🗑️ RF03 - Excluir Operador

![Logo.png](Logo.png){ width=150 }

## 📝 Descrição

Esta funcionalidade permite que o administrador desative ou exclua um operador do sistema Quilombo Pena Branca, impedindo seu acesso ao sistema quando necessário, por exemplo, em caso de desligamento.

## 👑 Atores

- Administrador do sistema

## ⚠️ Pré-condições

- O administrador deve estar autenticado no sistema
- O operador a ser excluído deve estar cadastrado no sistema
- O administrador não pode excluir sua própria conta
- Deve haver pelo menos um administrador ativo no sistema

## 🔌 Endpoints

- `DELETE /api/v1/users/{id}`

## 📋 Dados para Exclusão

| Campo        | Tipo     | Obrigatório | Descrição                  | Restrições             |
|--------------|----------|-------------|----------------------------|------------------------|
| `id`         | `integer`| ✅ Sim      | ID do operador a excluir   | Deve existir no sistema|
| `reason`     | `string` | ✅ Sim      | Motivo da exclusão         | Mínimo de 5 caracteres |
| `softDelete` | `boolean`| ❌ Não      | Exclusão lógica ou física  | Default: true (lógica) |

## 🔄 Fluxo Principal

```mermaid
sequenceDiagram
    actor A as Administrador
    participant S as Sistema
    participant BD as Banco de Dados
    
    A->>S: Acessa a página de listagem de operadores
    S->>BD: Busca operadores cadastrados
    BD->>S: Retorna lista de operadores
    S->>A: Exibe lista de operadores
    A->>S: Seleciona operador para exclusão
    S->>A: Exibe tela de confirmação com campo para motivo
    A->>S: Preenche motivo e confirma exclusão
    S->>S: Valida dados e verifica regras de negócio
    S->>BD: Marca operador como inativo (exclusão lógica)
    BD->>S: Confirma exclusão
    S->>A: Exibe mensagem de confirmação
```

1. O administrador acessa a página de listagem de operadores.
2. O sistema exibe a lista de operadores cadastrados.
3. O administrador seleciona o operador que deseja excluir.
4. O sistema exibe uma tela de confirmação com campo para informar o motivo da exclusão.
5. O administrador preenche o motivo e confirma a exclusão.
6. O sistema valida os dados e verifica as regras de negócio (não pode excluir o último administrador).
7. O sistema marca o operador como inativo (exclusão lógica).
8. O sistema exibe uma mensagem de confirmação da exclusão.

## 🔀 Fluxos Alternativos

### ⚠️ F01 - Operador não encontrado

```mermaid
sequenceDiagram
    actor A as Administrador
    participant S as Sistema
    participant BD as Banco de Dados
    
    A->>S: Tenta excluir um operador
    S->>BD: Busca operador pelo ID
    BD->>S: Operador não encontrado
    S->>A: Exibe mensagem de erro
```

1. No passo 3 do fluxo principal, o sistema verifica que o operador não existe.
2. O sistema exibe uma mensagem informando que o operador não foi encontrado.
3. O sistema mantém o administrador na página de listagem de operadores.

### ⚠️ F02 - Tentativa de excluir o último administrador

```mermaid
sequenceDiagram
    actor A as Administrador
    participant S as Sistema
    participant BD as Banco de Dados
    
    A->>S: Tenta excluir um operador administrador
    S->>BD: Verifica se é o último administrador
    BD->>S: Confirma que é o último administrador
    S->>A: Exibe mensagem de erro
```

1. No passo 6 do fluxo principal, o sistema verifica que o operador é o último administrador.
2. O sistema exibe uma mensagem informando que não é possível excluir o último administrador.
3. A operação é cancelada.

### ⚠️ F03 - Tentativa de excluir a própria conta

1. No passo 5 do fluxo principal, o sistema verifica que o administrador está tentando excluir sua própria conta.
2. O sistema exibe uma mensagem informando que não é possível excluir a própria conta.
3. A operação é cancelada.

## 🧪 Exemplo de Requisição

### Requisição HTTP
```http
DELETE /api/v1/users/42 HTTP/1.1
Host: api.quilombopenabranca.org
Content-Type: application/json
Authorization: Bearer {token}

{
  "reason": "Desligamento do funcionário",
  "softDelete": true
}
```

### Resposta de Sucesso
```http
HTTP/1.1 200 OK
Content-Type: application/json

{
  "message": "Operador excluído com sucesso",
  "deletedAt": "2023-06-20T09:15:30Z"
}
```

## 🖼️ Interface de Confirmação

![Confirmação de Exclusão de Operador](https://via.placeholder.com/600x400.png?text=Confirmação+de+Exclusão+de+Operador)

## ⚠️ Impactos da Exclusão

Quando um operador é excluído do sistema:

- 🚫 Não pode mais realizar login no sistema
- 📝 Seu registro permanece no banco de dados para fins de auditoria (exclusão lógica)
- 🔄 Pode ser reativado posteriormente por um administrador, se necessário
- 📊 Suas ações passadas permanecem registradas nos logs do sistema
- 👤 Seu nome continua aparecendo nos registros de atividades realizadas anteriormente

## 🔐 Considerações de Segurança

- Por padrão, a exclusão é lógica (softDelete = true)
- Para exclusão física (remoção do banco de dados), é necessário acesso direto ao banco
- Todas as tentativas de exclusão são registradas no log do sistema
- A exclusão de um operador não afeta os dados de membros cadastrados por ele

---

<div align="center">
  <h3>🌙 Quilombo Pena Branca 🌙</h3>
  <p>Honrando nossas raízes, construindo nosso futuro</p>
</div>
